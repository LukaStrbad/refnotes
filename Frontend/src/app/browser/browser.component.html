@if (currentFolder == null) {
  <div>
    Loading...
  </div>
} @else {
  <div class="m-2 flex gap-2 justify-end">
    <button
      class="btn btn-accent btn-sm"
      (click)="folderModal.show()"
    >
      <i class="bi bi-folder-plus"></i>
      New Folder
    </button>

    <button
      class="btn btn-accent btn-sm"
      (click)="fileModal.show()"
    >
      <i class="bi bi-file-earmark-plus"></i>
      New file
    </button>

    <app-create-new-modal #folderModal modalType="folder" (onCreate)="createNewFolder($event)"></app-create-new-modal>
    <app-create-new-modal #fileModal (onCreate)="createNewFile($event)" (onUpload)="onFilesUpload($event)"
                          [uploadProgress]="uploadProgress"></app-create-new-modal>
  </div>

  <div class="overflow-x-auto mt-6">
    <div class="breadcrumbs text-sm">
      <ul>
        @for (breadcrumb of breadcrumbs; track breadcrumb.path) {
          <li>
            <a (click)="navigateToFolder(breadcrumb.path)">
              {{ breadcrumb.name }}
            </a>
          </li>
        }
      </ul>
    </div>

    <table class="table table-pin-rows">
      <thead>
      <tr>
        <!-- For icons-->
        <th></th>
        <th class="text-center">Name</th>
        <th class="text-end">Actions</th>
      </tr>
      </thead>

      @if (currentFolder.directories.length > 0) {
        <thead>
        <tr>
          <th colspan="3">Folders</th>
        </tr>
        </thead>
      }
      <tbody>
        @for (folderName of currentFolder.directories; track folderName) {
          <tr (click)="openFolder(folderName)" class="hover:bg-base-300">
            <td>
              <i class="bi bi-folder"></i>
            </td>
            <td class="text-center">
              {{ folderName }}
            </td>
            <td class="flex gap-2 justify-end">
              <button class="btn btn-sm btn-error" (click)="$event.stopPropagation(); deleteFolder(folderName)">
                <i class="bi bi-trash"></i>
                Delete
              </button>
            </td>
          </tr>
        }
      </tbody>

      @if (currentFolder.files.length > 0) {
        <thead>
        <tr>
          <th colspan="3">Files</th>
        </tr>
        </thead>
      }
      <tbody>
        @for (fileName of currentFolder.files; track fileName) {
          <tr class="hover:bg-base-300">
            <td>
              <i class="bi"
                 [ngClass]="{'bi-filetype-md' : isMarkdownFile(fileName), 'bi-file-text': isTextFile(fileName), 'bi-file-earmark': true}"></i>
            </td>
            <td class="text-center">
              {{ fileName }}
            </td>
            <td class="flex gap-2 justify-end">
              <button class="btn btn-sm btn-accent">
                <i class="bi bi-pencil"></i>
                Edit
              </button>
              <button class="btn btn-sm btn-error" (click)="deleteFile(fileName)">
                <i class="bi bi-trash"></i>
                Delete
              </button>
          </tr>
        }
      </tbody>
    </table>
  </div>
}
